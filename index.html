<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trius Books</title>
    <link rel="stylesheet" href="static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Trius Books</h1>
        <p class="site-description">íŠ¸ë¦¬ìš°ìŠ¤ ë¼ìš´ì§€ì—ì„œ ì½ì„ ìˆ˜ ìˆëŠ” ë„ì„œ ëª©ë¡ì…ë‹ˆë‹¤.<br>ê°œì¸ì ìœ¼ë¡œ ë§Œë“  ê²ƒì´ë¼ ë¶€ì¡±í•˜ì§€ë§Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ğŸ“š</p>
        
        <div class="search-section">
            <form class="search-form" onsubmit="searchBooks(event)">
                <div class="search-input-group">
                    <input type="text" id="searchInput" name="query" placeholder="ğŸ”  ë„ì„œëª…, ì €ì, í‚¤ì›Œë“œë¡œ ê²€ìƒ‰" value="">
                    <button type="submit">ê²€ìƒ‰</button>
                </div>
            </form>
        </div>

        <div class="button-group">
            <a href="trius_book_list.csv" class="download-btn" download>ğŸ“¥  ì „ì²´ëª©ë¡ ë‹¤ìš´ë¡œë“œ</a>
            <button type="button" class="upload-btn" onclick="showUploadInfo()">ë„ì„œ ì—…ë°ì´íŠ¸ ë°©ë²•</button>
        </div>

        <div class="books-list">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable(0)">ğŸ“Œ  ë²ˆí˜¸ <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable(1)">ğŸ“–  ë„ì„œëª… <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable(2)">âœï¸  ì €ì <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable(3)">ğŸ“‘  ë¶„ë¥˜ <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable(4)">ğŸ‘¥  ì¶”ì²œ ëŒ€ìƒ <span class="sort-icon">â†•</span></th>
                        </tr>
                    </thead>
                    <tbody id="books-table-body">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem; color: #7f8c8d;">
                                ğŸ“š ë„ì„œ ëª©ë¡ì„ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>Â© 2024 Agnes Legrand. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let booksData = [];
        let currentSortColumn = -1;
        let sortAscending = true;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ CSV ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            loadCSVData();
        });

        // CSV íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadCSVData() {
            try {
                const response = await fetch('trius_book_list.csv');
                const csvText = await response.text();
                
                if (csvText.trim()) {
                    parseCSV(csvText);
                    displayBooks(booksData);
                } else {
                    showNoResults('CSV íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('CSV ë¡œë”© ì˜¤ë¥˜:', error);
                showNoResults('ë„ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // CSV í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±í•˜ì—¬ ë°°ì—´ë¡œ ë³€í™˜
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            
            booksData = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                if (values.length >= headers.length) {
                    const book = {};
                    headers.forEach((header, index) => {
                        book[header] = values[index] || '';
                    });
                    booksData.push(book);
                }
            }
        }

        // ë„ì„œ ëª©ë¡ì„ í…Œì´ë¸”ì— í‘œì‹œ
        function displayBooks(books) {
            const tbody = document.getElementById('books-table-body');
            
            if (books.length === 0) {
                showNoResults('ğŸ”  ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            tbody.innerHTML = '';
            books.forEach(book => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${book['ë²ˆí˜¸'] || ''}</td>
                    <td>${book['ë„ì„œëª…'] || ''}</td>
                    <td>${book['ì €ì'] || ''}</td>
                    <td>${book['ë¶„ë¥˜'] || ''}</td>
                    <td>${book['ì¶”ì²œ ëŒ€ìƒ'] || ''}</td>
                `;
            });
        }

        // ê²°ê³¼ ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
        function showNoResults(message) {
            const tbody = document.getElementById('books-table-body');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 2rem; color: #7f8c8d;">
                        ${message}
                    </td>
                </tr>
            `;
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchBooks(event) {
            event.preventDefault();
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!query) {
                displayBooks(booksData);
                return;
            }

            const filteredBooks = booksData.filter(book => {
                return (book['ë„ì„œëª…'] && book['ë„ì„œëª…'].toLowerCase().includes(query)) ||
                       (book['ì €ì'] && book['ì €ì'].toLowerCase().includes(query)) ||
                       (book['ë¶„ë¥˜'] && book['ë¶„ë¥˜'].toLowerCase().includes(query)) ||
                       (book['ì¶”ì²œ ëŒ€ìƒ'] && book['ì¶”ì²œ ëŒ€ìƒ'].toLowerCase().includes(query));
            });

            displayBooks(filteredBooks);
        }

        // í…Œì´ë¸” ì •ë ¬ ê¸°ëŠ¥
        function sortTable(columnIndex) {
            if (currentSortColumn === columnIndex) {
                sortAscending = !sortAscending;
            } else {
                currentSortColumn = columnIndex;
                sortAscending = true;
            }

            const columnNames = ['ë²ˆí˜¸', 'ë„ì„œëª…', 'ì €ì', 'ë¶„ë¥˜', 'ì¶”ì²œ ëŒ€ìƒ'];
            const columnName = columnNames[columnIndex];

            booksData.sort((a, b) => {
                let aVal = a[columnName] || '';
                let bVal = b[columnName] || '';

                // ë²ˆí˜¸ ì»¬ëŸ¼ì¸ ê²½ìš° ìˆ«ìë¡œ ë¹„êµ
                if (columnIndex === 0) {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                } else {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (aVal < bVal) return sortAscending ? -1 : 1;
                if (aVal > bVal) return sortAscending ? 1 : -1;
                return 0;
            });

            displayBooks(booksData);

            // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            updateSortIcons(columnIndex);
        }

        // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        function updateSortIcons(activeColumn) {
            const headers = document.querySelectorAll('th.sortable .sort-icon');
            headers.forEach((icon, index) => {
                if (index === activeColumn) {
                    icon.textContent = sortAscending ? 'â†‘' : 'â†“';
                } else {
                    icon.textContent = 'â†•';
                }
            });
        }

        // ì—…ë¡œë“œ ì •ë³´ í‘œì‹œ
        function showUploadInfo() {
            alert('ë„ì„œëª©ë¡ì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ë²•:\n\n' +
                  '1. CSV íŒŒì¼ì„ trius_book_list.csvë¡œ ì €ì¥í•´ ì£¼ì„¸ìš”.\n' +
                  '2. íŒŒì¼ì€ ë‹¤ìŒ ì»¬ëŸ¼ì„ ìˆœì„œëŒ€ë¡œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:\n' +
                  '   - ë²ˆí˜¸, ë„ì„œëª…, ì €ì, ë¶„ë¥˜, ì¶”ì²œ ëŒ€ìƒ\n' +
                  '3. GitHubì—ì„œ ì§ì ‘ íŒŒì¼ì„ êµì²´í•´ ì£¼ì„¸ìš”.\n\n' +
                  'ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ dooook@gmail.com ìœ¼ë¡œ ë©”ì¼ ì£¼ì„¸ìš”');
        }
    </script>
</body>
</html>
